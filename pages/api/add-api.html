<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="../../static/img/favicon.ico">
    <title>添加接口</title>
    <link href="../../static/libs/inspinia/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="../../static/libs/inspinia/font-awesome/css/font-awesome.css" rel="stylesheet">-->
    <link href="../../static/libs/inspinia/css/animate.css" rel="stylesheet">
    <link href="../../static/libs/inspinia/css/style.css" rel="stylesheet">
    <link href="../../static/css/main.css" rel="stylesheet">
    <script src="../../static/libs/inspinia/js/respond.src.js"></script>
    <script src="../../static/js/vue.min.js"></script>
    <title>添加接口</title>
</head>
<body>
<div class="wrapper">
    <div class="grap-bg">
        <div id="header"></div>
        <div class="row wrapper border-bottom white-bg title-row">
            <div class="col-sm-6">
                <h2 class="pro-list-h3">增加接口</h2>
            </div>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-content">
                            <ul class="phone-ul clearfix">
                                <li class="col-lg-6">
                                    <form class="error-tips-bottom create-product" id="create-form" method="POST">
                                        <ul class="create-ul create-w">
                                            <li>
                                                <div class="product-brands-box">
                                                    <p class="input-title create-ul-h5">项目<span class="red-color">*</span></p>

                                                    <div class="brands-box" id="form-control-create">
                                                        <select class="form-control-create" name="project_id" id="project_select" onclick="projectChange()">
                                                            <option v-for="project in project_select" v-bind:value="project.project_id">{{project.project_name}}</option>
                                                        </select>
                                                        <input type="hidden" value="" name="project_name" id="project_name">
                                                    </div>

                                                    <a href="../project/add-project.html" class="new-brands">添加新项目</a>
                                                </div>
                                            </li>
                                            <li>
                                                <div class="search-bar"></div>
                                                请选择接口请求方法
                                                <select class="form-control-sel m-b" id="method_select" name="request_method" onclick="methodChange()">
                                                    <option value="POST">POST</option>
                                                    <option value="GET">GET</option>
                                                    <option value="PUT">PUT</option>
                                                    <option value="DELETE">DELETE</option>
                                                    <option value="HEAD">HEAD</option>
                                                    <option value="CONNECT">CONNECT</option>
                                                    <option value="OPTIONS">OPTIONS</option>
                                                    <option value="TRACE">TRACE</option>
                                                </select>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5" aria-placeholder="">接口ID<span class="red-color">*</span></p>
                                                <input type="text" placeholder="请输入接口ID 格式为：接口名称首字母" class="form-control input-lg create-inp create-inp-num" id="api_id" name="api_id"/>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5">接口名称<span class="red-color">*</span></p>
                                                <input type="text" placeholder="请输入接口名称" class="form-control input-lg create-inp create-inp-num" id="api-name" name="api_name"/>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5">URL<span class="red-color">*</span></p>
                                                <input type="text" placeholder="请输入接口的URL" class="form-control input-lg create-inp create-inp-num" id="api-url" name="api_url"/>
                                                <div class="prompt-box hidden"></div>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5">路径<span class="red-color">*</span></p>
                                                <input type="text" placeholder="请输入接口路径" class="form-control input-lg create-inp" id="api-path" name="api_path"/>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5">期望结果<span class="red-color">*</span></p>
                                                <input type="text" placeholder="请期望结果" class="form-control input-lg create-inp" id="expect_response_data" name="expect_response_data"/>
                                            </li>
                                            <li>
                                                <p class="input-title create-ul-h5">接口参数<span class="red-color">*</span></p>
                                                <div class="">
                                                    <span>key</span>
                                                    <input type="text" class="form-control newadd para_input para_key" placeholder="添加key值"/>
                                                    <span class="input-group-btn">
                                                        <button type="button" class="btn btn-outline btn-danger newadd-remove">删除</button>
                                                    </span>
                                                </div>
                                                <span>value</span>
                                                <input type="text" placeholder="请输入value值" class="form-control input-lg newadd-con para_input para_value"/>
                                                <input class="para_div" style='width: 600px; height:50px;' onfocus=this.blur() name="request_data" >
                                            </li>
                                            <button type="button" class="btn btn-block btn-outline btn-success newadd-button">＋继续添加更多参数</button>
                                            <button type="button" class="btn btn-w-m btn-primary">添加接口</button>
                                        </ul>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<li class="hidden newadd-li">
    <div class="input-group create-w">
        <span>key</span>
        <input type="text" class="form-control newadd" name="more_title" maxlength="10" placeholder="添加key值"/>
        <span class="input-group-btn">
            <button type="button" class="btn btn-outline btn-danger newadd-remove">删除</button>
        </span>
    </div>
    <span>value</span>
    <input type="text" placeholder="请输入vlaue值" maxlength="30" name="more_con" class="form-control input-lg newadd-con">
</li>
<li class="hidden mobile-hidden-li">
    <span class="format-name"></span>
    <span class="format-con"></span>
</li>
<!--javascript-->
<!-- Mainly scripts -->
<script src="../../static/libs/jquery/jquery.min.js"></script>
<script src="../../static/libs/jquery.validate.min.js"></script>
<!--<script src="../../static/libs/cropbox/cropbox.js"></script>-->
<script src="../../static/libs/inspinia/js/bootstrap.min.js"></script>
<script src="../../static/libs/inspinia/js/plugins/jeditable/jquery.jeditable.js"></script>

<!-- Data Tables -->
<script src="../../static/libs/inspinia/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="../../static/libs/inspinia/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="../../static/libs/inspinia/js/plugins/dataTables/dataTables.responsive.js"></script>
<script src="../../static/libs/inspinia/js/plugins/dataTables/dataTables.tableTools.min.js"></script>

<script src="../../static/libs/inspinia/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../../static/libs/inspinia/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="../../static/libs/inspinia/js/inspinia.js"></script>
<script src="../../static/libs/inspinia/js/plugins/pace/pace.min.js"></script>
<script>

    $(function(){
        $(".para_input").bind('input porpertychange',function(){
            console.log("e");
            var keyValue = $(".para_key").val();
            var valueValue = $(".para_value").val();
            $(".para_div").val(keyValue+ ":" + valueValue);
        });
    });


    function projectChange() {
        $("#project_select option:selected").val();
        var options=$("#project_select option:selected").text();
        console.log(options);
        document.getElementById("project_name").value = options;

    };

    // $(function () {
    //     var options=$("#project_select option:selected").text();
    //     // document.getElementById("project_name").value = options;
    //     $("#project-name").value = options;
    // });

    function methodChange() {
        $("#method_select option:selected").text();
    }
    $(function () {
        get_project_list();
    });

    function get_project_list(){
        $.ajax({
            type:"get",
            data:{},
            datatype:"json",
            url:"http://127.0.0.1/api/test_manager/project_manager/project_list/",
            success:function (data) {
                new Vue({
                    el:"#project_select",
                    data:{
                        project_select:data.project_list,
                    },
                })
            },
            error:function () {
                alert("error")
            }
        })
    }

    function change_more_info(){
        $(".mobile-show-li").remove();
        var newadd=$('.newadd');
        var newaddcon=$('.newadd-con');
        for (var i=0; i<newadd.length; i++){
            if(newadd[i].value || newaddcon[i].value){
                var mobile_show_li = $(".mobile-hidden-li.hidden").clone();
                mobile_show_li.removeClass("hidden");
                mobile_show_li.addClass("mobile-show-li");
                mobile_show_li.find("span.format-name").text(newadd[i].value + "：");
                mobile_show_li.find("span.format-con").text(newaddcon[i].value);
                $(".format-ul").append(mobile_show_li);
            }
        }
    }

    function new_more_info(){
        var mobile_show_li = $(".mobile-hidden-li.hidden").clone();
        mobile_show_li.removeClass("hidden");
        mobile_show_li.addClass("mobile-show-li");
        mobile_show_li.find("span.format-name").text( "新增：");
        mobile_show_li.find("span.format-con").text("");
        $(".format-ul").append(mobile_show_li);
    }


    // more-info
    $(".newadd-button").click(function(){
        var newadd_li = $(".newadd-li.hidden").clone();
        newadd_li.removeClass("hidden");
        $(this).before(newadd_li);
        new_more_info();
    });
    $("body").on("click", ".newadd-remove", function() {
        $(this).parents("li")[0].remove();
        change_more_info();
    });
    $("body").on("change", ".newadd", function() {
        change_more_info();
    });
    $("body").on("change", ".newadd-con", function() {
        change_more_info();
    });

    $(function () {
        $(".btn-w-m").click(function () {
            $.ajax({
                type:"post",
                dataType:"json",
                url:"http://127.0.0.1/api/test_manager/api_manager/add_api/",
                data:$("#create-form").serialize(),
                success:function (data) {
                    console.log(data);
                    window.location.href="/pages/api/api-list.html";
                },
                error:function () {
                    alert("error")
                }
            });
        })
    })
</script>
</body>
</html>